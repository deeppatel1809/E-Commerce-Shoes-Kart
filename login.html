<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.9.1/font/bootstrap-icons.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="css\shoes.css">
    <link rel="stylesheet" href="css\account.css">
    <title>Login/Register</title>
</head>
<body>
    <header id="header">
    </header>
    <nav id="navbar">
    </nav>
    <div id="account-sidebar">
    </div>
    <div class="container-fluid">
        <h4 class="text-center mt-4 mb-4">Login/Register</h4>
        <div class="row">
            <div class="col-10 offset-1 col-sm-8 offset-sm-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4 p-0">
                <div style="border-top: 2px solid black;"></div>
                    <div class="row my-3">
                        <div class="col">
                            <label id="phone-label" for="login-phone" class="form-label">Phone</label>
                            <input type="text" class="form-control" id="login-phone" required>
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col">
                            <label id="password-label" for="login-password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="login-password" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <a href="register.html">New user? Register here</a>
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-12 col-lg-6 text-lg-center p-0">
                            <a class="btn btn-link text-dark fw-bold p-0" onclick="email()">Login with email and password</a>
                        </div>
                        <div class="col-12 col-lg-6 text-lg-center p-0">
                            <a class="btn btn-link text-dark fw-bold p-0" onclick="phone()">Login with phone and password</a>
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col text-center">
                            <button class="btn btn-dark mt-3" type="submit" onclick="login()">Login</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <footer id="footer">
    </footer>
    <script src="js\shoes.js"></script>
    <script src="js\account.js"></script>
    <script>
        window.onload = function()
        {
            showHeader();
            showNavbar();
            showFooter();
        }

        function email()
        {
            const label = document.getElementById("phone-label");
            const inputField = document.getElementById("login-phone");

            label.textContent = "Email";
            label.setAttribute("id", "email-label");
            label.setAttribute("for", "login-email");

            inputField.setAttribute("id", "login-email");
            inputField.setAttribute("type", "email");
            inputField.value = "";
        }

        function phone()
        {
            const label = document.getElementById("email-label");
            const inputField = document.getElementById("login-email");

            label.textContent = "Phone";
            label.setAttribute("id", "phone-label");
            label.setAttribute("for", "login-phone");

            inputField.setAttribute("id", "login-phone");
            inputField.setAttribute("type", "text");
            inputField.value = "";
        }

        function login()
        {
            const users = JSON.parse(localStorage.getItem('users')) || [];

            if(document.getElementById("phone-label"))
            {
                const phone = document.getElementById("login-phone").value;
                const password = document.getElementById("login-password").value;

                if (phone == "" && password == "")
                {
                    alert("Please enter your phone and password.");
                    return;
                }

                if (phone == "")
                {
                    alert("Please enter phone number.")
                    return;
                }

                if (password == "")
                {
                    alert("Please enter password.")
                    return;
                }

                phonePat = /[0-9]{10}/;

                if (!phonePat.test(phone))
                {
                    alert("Please enter a valid 10 digit phone number.");
                    document.getElementById("login-phone").value = "";
                    return;
                }

                const user = users.find(item => item.login.phone === phone);

                if (user)
                {
                    if (user.login.password === password)
                    {
                        const e = {phone: phone};
                        localStorage.setItem("loginUser",JSON.stringify(e));
                        alert("Login successfull!");
                        setTimeout(function() {
                            window.location.href = "index.html";
                        },600);
                    }
                    else
                    {
                        alert("Incorrect password. Please try again.");
                        document.getElementById("login-phone").value = "";
                        document.getElementById("login-password").value ="";
                    }
                }
                else
                {
                    alert("No user found.");
                }
            }
            else
            {
                const email = document.getElementById("login-email").value;
                const password = document.getElementById("login-password").value;

                if (email == "" && password == "")
                {
                    alert("Please enter your email and password.");
                    return;
                }

                if (email == "")
                {
                    alert("Please enter email.")
                    return;
                }

                if (password == "")
                {
                    alert("Please enter password.")
                    return;
                }

                const user = users.find(item => item.login.email === email);

                if (user)
                {
                    if (user.login.password === password)
                    {
                        const e = {email: email};
                        localStorage.setItem("loginUser",JSON.stringify(e));
                        alert("Login successfull!");
                        setTimeout(function() {
                            window.location.href = "index.html";
                        },600);
                    }
                    else
                    {
                        alert("Incorrect password. Please try again.");
                        document.getElementById("login-email").value = "";
                        document.getElementById("login-password").value ="";
                    }
                }
                else
                {
                    alert("No user found.");
                }
            }
        }
    </script>
</body>
</html>